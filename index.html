<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {
        'packages':['geochart'],
        // Note: you will need to get a mapsApiKey for your project.
        // See: https://developers.google.com/chart/interactive/docs/basic_load_libs#load-settings
        'mapsApiKey': 'AIzaSyD-9tSrke72PouQMnMX-a7eZSW0jkFMBWY'
      });
      google.charts.setOnLoadCallback(drawRegionsMap);
		arr = [];
	
	    
	var all_data; 
	$.getJSON('world_covid_data.json', function(data) {
    // JSON result in `data` variable
	console.log("DATA RECIEVED--------------------");
	console.log(data);
	all_data = data;
	});
	    
	    
	function get_day_data(data, day)
	    {
		    //var x = new Date(2019,12,1);
		    
		    var x = new Date(2019,12,31);
		    x.setDate(x.getDate()+day);
    		    //var str = ((date.getMonth() > 8) ? (date.getMonth() + 1) : ('0' + (date.getMonth() + 1))) + '/' + ((date.getDate() > 9) ? date.getDate() : ('0' + date.getDate())) + '/' + date.getFullYear();
		    //str = "6/16/2020";
		    ///x.setDate(x.getDate()+day);
		    
		    var Y = x.getYear()+1900;
		    var M = x.getMonth()+1;
		    var D = x.getDay()+1;
		    
		    
		    //var str = Y.toString()+"-"+M.toString()+"-"+D.toString();
		    var str = M.toString()+"/"+D.toString()+"/"+ Y.toString();
		    //var str = x.toISOString().substr(0,10)
		    var res = [['Country', 'Cases']];
		    
		    if(all_data == null)
			    return [];
		    all_data.forEach(function(row){
			    if (row.date == str)
				    res.push([row.location, row.total_cases]);
		    });
		    
		    return res;
	    }

	  time = 0
	  first = true
      function drawRegionsMap() {

		
		var chart = new google.visualization.GeoChart(document.getElementById('regions_div'));

        <!-- var data = google.visualization.arrayToDataTable([ -->
          <!-- ['Country', 'Popularity'], -->
          <!-- ['Germany', 200], -->
          <!-- ['United States', 300], -->
          <!-- ['Brazil', 400], -->
          <!-- ['Canada', 500], -->
          <!-- ['France', 600], -->
          <!-- ['RU', x] -->
        <!-- ]); -->
		
		//console.log(arr[time][0][1])
		//console.log(arr[time][1][1])
		//console.log(arr[time][2][1])
	      	dayArr = get_day_data(all_data,time);
		var data = google.visualization.arrayToDataTable(dayArr);
		time = time+1;
		
        var options = {
		// region: 'US', 
		//displayMode: 'markers',
		 colorAxis: {colors: ['green', 'red']}, 
		  animation:{
			duration: 1000,
			easing: 'out'
		  }
		};

        

		 google.visualization.events.addListener(chart, 'ready',
          function() {
            //button.disabled = false;
          });
		  
        chart.draw(data, options);
		
	    tt = setInterval(function(){
		//drawRegionsMap();
		time = time + 1; 		
		//data = google.visualization.arrayToDataTable(arr[time]);
		dayArr = get_day_data(all_data,time);
		var data = google.visualization.arrayToDataTable(dayArr);
		chart.draw(data, options);
		}, 1000);
		
      }
	  

    </script>
  </head>
  <body>
    <div id="regions_div" style="width: 900px; height: 500px;"></div>
  </body>
</html>
